/*! For license information please see content.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==o.return||o.return()}finally{if(c)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",s=n.toStringTag||"@@toStringTag";function a(n,o,r,s){var a=o&&o.prototype instanceof l?o:l,u=Object.create(a.prototype);return i(u,"_invoke",function(n,o,i){var r,s,a,l=0,u=i||[],d=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return r=t,s=0,a=e,p.n=n,c}};function h(n,o){for(s=n,a=o,t=0;!d&&l&&!i&&t<u.length;t++){var i,r=u[t],h=p.p,f=r[2];n>3?(i=f===o)&&(a=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=h&&((i=n<2&&h<r[1])?(s=0,p.v=o,p.n=r[1]):h<f&&(i=n<3||r[0]>o||o>f)&&(r[4]=n,r[5]=o,p.n=f,s=0))}if(i||n>1)return c;throw d=!0,o}return function(i,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,f),s=u,a=f;(t=s<2?e:a)||!d;){r||(s?s<3?(s>1&&(p.n=-1),h(s,a)):p.n=a:p.v=a);try{if(l=2,r){if(s||(i="next"),t=r[i]){if(!(t=t.call(r,a)))throw TypeError("iterator result is not an object");if(!t.done)return t;a=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(a=TypeError("The iterator does not provide a '"+i+"' method"),s=1);r=e}else if((t=(d=p.n<0)?a:n.call(o,p))!==c)break}catch(t){r=e,s=1,a=t}finally{l=1}}return{value:t,done:d}}}(n,r,s),!0),u}var c={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),h=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,i(h,"constructor",d),i(d,"constructor",u),u.displayName="GeneratorFunction",i(d,s,"GeneratorFunction"),i(h),i(h,s,"Generator"),i(h,r,function(){return this}),i(h,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:f}})()}function i(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}i=function(e,t,n,o){function s(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},i(e,t,n,o)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e,t,n,o,i,r,s){try{var a=e[r](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,i)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var r=e.apply(t,n);function s(e){a(r,o,i,s,c,"next",e)}function c(e){a(r,o,i,s,c,"throw",e)}s(void 0)})}}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,d(o.key),o)}}function u(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var p=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"inspectorState",{isActive:!1,selectedElements:[],hoveredElement:void 0}),u(this,"overlay",null),u(this,"tooltip",null),u(this,"selectionCounter",null),u(this,"initialized",!1),u(this,"handleMouseOver",function(e){if(t.inspectorState.isActive){var n=e.target;t.isIgnoredElement(n)||(t.highlightElement(n),t.showTooltip(n,e),t.inspectorState.hoveredElement=t.getElementData(n))}}),u(this,"handleMouseOut",function(e){if(t.inspectorState.isActive){var n=e.target;t.isIgnoredElement(n)||(t.removeHighlight(n),t.hideTooltip(),t.inspectorState.hoveredElement=void 0)}}),u(this,"handleClick",function(e){if(t.inspectorState.isActive){e.preventDefault(),e.stopPropagation();var n=e.target;if(!t.isIgnoredElement(n)){var o=t.getElementData(n),i=t.inspectorState.selectedElements.findIndex(function(e){return e.xpath===o.xpath});i>=0?(t.inspectorState.selectedElements.splice(i,1),t.removeSelectionHighlight(n)):(t.inspectorState.selectedElements.push(o),t.addSelectionHighlight(n)),t.updateSelectionCount()}}}),u(this,"handleKeyDown",function(e){if(t.inspectorState.isActive)switch(e.key){case"Escape":t.stopInspecting();break;case"Enter":t.inspectorState.selectedElements.length>0&&(t.stopInspecting(),t.generateTestFromSelection());break;case"Delete":case"Backspace":t.clearSelection()}}),this.init()},n=[{key:"init",value:function(){var e=this;this.initialized||(this.initialized=!0,chrome.runtime.onMessage.addListener(function(t,n,o){switch(t.action){case"startInspecting":e.startInspecting(),o({success:!0});break;case"stopInspecting":e.stopInspecting(),o({success:!0});break;case"ping":o({success:!0,message:"Content script is ready"});break;case"getSelectedElements":o({success:!0,count:e.inspectorState.selectedElements.length,elements:e.inspectorState.selectedElements});break;case"generateTest":e.generateTest(t.settings,t.testScenario),o({success:!0});break;case"runTest":e.runTest(t.test,t.mode),o({success:!0});break;case"clearSelection":e.clearSelection(),o({success:!0});break;case"notifyDevTools":window.postMessage({type:t.type,data:t.data},"*"),o({success:!0});break;default:o({error:"Unknown action"})}return!0}),this.createOverlay(),this.createTooltip(),this.createSelectionCounter())}},{key:"createOverlay",value:function(){this.overlay=document.createElement("div"),this.overlay.id="ai-testgen-overlay",this.overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(59, 130, 246, 0.1);\n      z-index: 999999;\n      pointer-events: none;\n      display: none;\n    ",document.body.appendChild(this.overlay)}},{key:"createTooltip",value:function(){this.tooltip=document.createElement("div"),this.tooltip.id="ai-testgen-tooltip",this.tooltip.style.cssText="\n      position: fixed;\n      background: #2d3748;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-size: 13px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      z-index: 1000000;\n      pointer-events: none;\n      display: none;\n      max-width: 280px;\n      min-width: 200px;\n      word-wrap: break-word;\n      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      backdrop-filter: blur(8px);\n    ",document.body.appendChild(this.tooltip)}},{key:"createSelectionCounter",value:function(){this.selectionCounter=document.createElement("div"),this.selectionCounter.className="ai-testgen-counter",this.selectionCounter.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: #1f2937;\n      color: white;\n      padding: 8px 16px;\n      border-radius: 20px;\n      font-size: 12px;\n      z-index: 1000001;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      display: none;\n    ",document.body.appendChild(this.selectionCounter)}},{key:"startInspecting",value:function(){this.inspectorState.isActive=!0,this.overlay.style.display="block",document.addEventListener("mouseover",this.handleMouseOver),document.addEventListener("mouseout",this.handleMouseOut),document.addEventListener("click",this.handleClick),document.addEventListener("keydown",this.handleKeyDown),this.showInstructions(),this.updateSelectionCounterDisplay()}},{key:"stopInspecting",value:function(){this.inspectorState.isActive=!1,this.overlay.style.display="none",this.tooltip.style.display="none",this.selectionCounter.style.display="none",document.removeEventListener("mouseover",this.handleMouseOver),document.removeEventListener("mouseout",this.handleMouseOut),document.removeEventListener("click",this.handleClick),document.removeEventListener("keydown",this.handleKeyDown),this.removeAllHighlights()}},{key:"isIgnoredElement",value:function(e){return"ai-testgen-overlay"===e.id||"ai-testgen-tooltip"===e.id||null!==e.closest("#ai-testgen-overlay")||null!==e.closest("#ai-testgen-tooltip")}},{key:"getElementData",value:function(e){var t,n=e.getBoundingClientRect(),o=this.getXPath(e),i=this.getCSSSelector(e);return{tagName:e.tagName.toLowerCase(),id:e.id||void 0,className:e.className||void 0,textContent:(null===(t=e.textContent)||void 0===t?void 0:t.trim().substring(0,100))||void 0,attributes:this.getElementAttributes(e),xpath:o,cssSelector:i,rect:{x:n.x,y:n.y,width:n.width,height:n.height,top:n.top,right:n.right,bottom:n.bottom,left:n.left},isVisible:this.isElementVisible(e)}}},{key:"getElementAttributes",value:function(e){for(var t={},n=0;n<e.attributes.length;n++){var o=e.attributes[n];t[o.name]=o.value}return t}},{key:"getXPath",value:function(e){if(e.id)return'//*[@id="'.concat(e.id,'"]');for(var t=[],n=e;n&&n.nodeType===Node.ELEMENT_NODE;){for(var o=1,i=n.previousElementSibling;i;)i.tagName===n.tagName&&o++,i=i.previousElementSibling;var r=n.tagName.toLowerCase(),s=o>1?"".concat(r,"[").concat(o,"]"):r;t.unshift(s),n=n.parentElement}return"/"+t.join("/")}},{key:"getCSSSelector",value:function(e){if(e.id)return"#".concat(e.id);for(var t=[],n=e;n;){var o=n.tagName.toLowerCase();if(n.className){var i=n.className.split(" ").filter(function(e){return e.trim()});i.length>0&&(o+="."+i.join("."))}if(t.unshift(o),!(n=n.parentElement)||"BODY"===n.tagName)break}return t.join(" > ")}},{key:"isElementVisible",value:function(e){var t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&e.offsetWidth>0&&e.offsetHeight>0}},{key:"highlightElement",value:function(e){e.classList.remove("ai-testgen-hover","ai-testgen-selected"),this.isElementSelected(e)||e.classList.add("ai-testgen-hover")}},{key:"removeHighlight",value:function(e){e.classList.remove("ai-testgen-hover"),this.isElementSelected(e)&&e.classList.add("ai-testgen-selected")}},{key:"addSelectionHighlight",value:function(e){e.classList.remove("ai-testgen-hover"),e.classList.add("ai-testgen-selected")}},{key:"removeSelectionHighlight",value:function(e){e.classList.remove("ai-testgen-selected","ai-testgen-hover")}},{key:"isElementSelected",value:function(e){var t=this.getElementData(e);return this.inspectorState.selectedElements.some(function(e){return e.xpath===t.xpath})}},{key:"removeAllHighlights",value:function(){document.querySelectorAll(".ai-testgen-hover").forEach(function(e){e.classList.remove("ai-testgen-hover")}),document.querySelectorAll(".ai-testgen-selected").forEach(function(e){e.classList.remove("ai-testgen-selected")})}},{key:"showTooltip",value:function(e,t){if(this.tooltip){var n=this.getElementData(e),o=this.isElementSelected(e),i=e.getBoundingClientRect(),r=Math.round(i.width),s=Math.round(i.height),a=n.className||"",c='\n      <div style="font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif; line-height: 1.4;">\n        <div style="color: #ffffff; font-weight: 500; margin-bottom: 2px;">\n          <strong>Tag:</strong> '.concat(n.tagName.toLowerCase(),"\n        </div>\n        ").concat(a?'<div style="color: #ffffff; font-weight: 500; margin-bottom: 2px;">\n          <strong>Classes:</strong> '.concat(a,"\n        </div>"):"",'\n        <div style="color: #ffffff; font-weight: 500; margin-bottom: 2px;">\n          <strong>Size:</strong> ').concat(r,"x").concat(s,"\n        </div>\n        ").concat(n.id?'<div style="color: #ffffff; font-weight: 500; margin-bottom: 2px;">\n          <strong>ID:</strong> '.concat(n.id,"\n        </div>"):"","\n        ").concat(o?'<div style="margin-top: 8px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 11px; color: #10b981;">\n          ✓ Selected - Click to deselect\n        </div>':'<div style="margin-top: 8px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 11px; color: #9ca3af;">\n          Click to select • ESC to exit\n        </div>',"\n      </div>\n    ");this.tooltip.innerHTML=c,this.tooltip.style.display="block",this.tooltip.style.left="".concat(t.clientX+10,"px"),this.tooltip.style.top="".concat(t.clientY-10,"px")}}},{key:"hideTooltip",value:function(){this.tooltip&&(this.tooltip.style.display="none")}},{key:"showInstructions",value:function(){var e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: #1f2937;\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      font-size: 14px;\n      z-index: 1000001;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    ",e.innerHTML='\n      <div style="text-align: center;">\n        <div style="font-weight: bold; margin-bottom: 8px;">🎯 AI TestGen Inspector</div>\n        <div style="font-size: 12px; opacity: 0.9;">\n          Hover to preview • Click to select • ESC to exit • Enter to generate test\n        </div>\n      </div>\n    ',document.body.appendChild(e),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},5e3)}},{key:"updateSelectionCount",value:function(){chrome.runtime.sendMessage({action:"updateSelectionCount",count:this.inspectorState.selectedElements.length}).catch(function(){}),this.updateSelectionCounterDisplay()}},{key:"updateSelectionCounterDisplay",value:function(){if(this.selectionCounter){var e=this.inspectorState.selectedElements.length;this.inspectorState.isActive?(this.selectionCounter.style.display="block",this.selectionCounter.innerHTML='\n        <span style="font-weight: bold;">🎯 '.concat(e,"</span> element").concat(1!==e?"s":""," selected\n      ")):this.selectionCounter.style.display="none"}}},{key:"clearSelection",value:function(){this.inspectorState.selectedElements=[],this.removeAllHighlights(),this.updateSelectionCount()}},{key:"generateTest",value:(p=c(o().m(function e(t,n){var i,r,a,c,l,u,d,p,h,f=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("🚀 Starting test generation with:",{settings:t,testScenario:n,selectedElements:this.inspectorState.selectedElements.length}),0!==this.inspectorState.selectedElements.length){e.n=1;break}return alert('Please select elements first by clicking "Inspect" and selecting page elements'),e.a(2);case 1:if(n&&n.trim()){e.n=2;break}return alert("Please describe your test scenario before generating the test"),e.a(2);case 2:return i=this.inspectorState.selectedElements.map(function(e,t){return{type:f.inferActionType(e),element:e,description:f.generateElementDescription(e,t)}}),r=this.inspectorState.selectedElements.map(function(e){return s(s({},e),{},{context:f.getElementContext(e),interactionType:f.inferActionType(e),accessibility:f.getAccessibilityInfo(e)})}),e.p=3,c={action:"generateTest",data:{framework:t.selectedFramework,actions:i,elements:r,userPrompt:n.trim(),pageContext:{url:window.location.href,title:document.title,elementCount:this.inspectorState.selectedElements.length}}},console.log("📤 Sending test generation request:",c),console.log("🔗 Extension context valid:",!(null===(a=chrome.runtime)||void 0===a||!a.id)),e.n=4,Promise.race([chrome.runtime.sendMessage(c),new Promise(function(e,t){return setTimeout(function(){return t(new Error("Message timeout after 30 seconds"))},3e4)})]);case 4:if(l=e.v,console.log("📥 Received response:",l),!l.success){e.n=7;break}return e.n=5,chrome.runtime.sendMessage({action:"saveTest",data:l.test});case 5:return u={id:Date.now().toString(),type:"assistant",content:l.test.code,timestamp:Date.now(),codeBlocks:[{language:this.getLanguageFromFramework(t.selectedFramework),code:l.test.code}]},e.n=6,chrome.runtime.sendMessage({action:"saveChatMessage",data:u});case 6:console.log("Test generated successfully:",l.test),console.log("Content script: Sending testGenerated message to popup",l.test),chrome.runtime.sendMessage({action:"testGenerated",test:l.test}).then(function(){console.log("Content script: testGenerated message sent successfully")}).catch(function(e){console.error("Content script: Failed to send testGenerated message",e)}),this.clearSelection(),this.stopInspecting(),e.n=8;break;case 7:console.error("Failed to generate test:",l.error),console.log("Content script: Sending testGenerationError message to popup",l.error),chrome.runtime.sendMessage({action:"testGenerationError",error:l.error||"Failed to generate test"}).then(function(){console.log("Content script: testGenerationError message sent successfully")}).catch(function(e){console.error("Content script: Failed to send testGenerationError message",e)});case 8:e.n=10;break;case 9:e.p=9,h=e.v,console.error("Error generating test:",h),p="Error generating test. Please check your AI provider configuration.",null!==(d=chrome.runtime)&&void 0!==d&&d.id?h instanceof Error&&(p=h.message.includes("message channel closed")?"Communication error with extension. Please reload the extension and try again.":h.message.includes("timeout")?"Request timed out. Please check your internet connection and AI provider settings.":"Error generating test: "+h.message):p="Extension context invalidated. Please reload the extension from chrome://extensions/",chrome.runtime.sendMessage({action:"testGenerationError",error:p});case 10:return e.a(2)}},e,this,[[3,9]])})),function(e,t){return p.apply(this,arguments)})},{key:"getLanguageFromFramework",value:function(e){return e.includes("python")?"python":e.includes("java")?"java":"typescript"}},{key:"generateElementDescription",value:function(e,t){var n,o,i=(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())||"element",r=e.id?"#".concat(e.id):"",s=e.className?".".concat(e.className.split(" ").join(".")):"",a=(null===(o=e.textContent)||void 0===o?void 0:o.trim().substring(0,50))||"",c=e.attributes.type?'[type="'.concat(e.attributes.type,'"]'):"";return"".concat(i).concat(r).concat(s).concat(c).concat(a?' - "'.concat(a,'"'):"")}},{key:"getElementContext",value:function(e){return{position:{x:Math.round(e.rect.x||0),y:Math.round(e.rect.y||0),width:Math.round(e.rect.width||0),height:Math.round(e.rect.height||0)},visible:e.isVisible,parent:e.tagName||null,siblings:0}}},{key:"getAccessibilityInfo",value:function(e){return{role:e.attributes.role||null,ariaLabel:e.attributes["aria-label"]||null,ariaDescribedBy:e.attributes["aria-describedby"]||null,tabIndex:e.attributes.tabindex||null,title:e.attributes.title||null}}},{key:"generateTestFromSelection",value:function(){var e=this;chrome.runtime.sendMessage({action:"getSettings"}).then(function(t){t.success&&e.generateTest(t.settings)})}},{key:"inferActionType",value:function(e){var t,n=e.tagName.toLowerCase(),o=null===(t=e.attributes.type)||void 0===t?void 0:t.toLowerCase();return"button"===n||"input"===n&&"button"===o||"input"===n&&"submit"===o?"click":"input"!==n||"text"!==o&&"email"!==o&&"password"!==o&&o?"textarea"===n?"type":"select"===n?"select":"click":"type"}},{key:"runTest",value:(d=c(o().m(function e(t){var n,i,r=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:"headless",e.p=1,console.log("Content script received runTest message with test:",t,"mode:",n),t){e.n=2;break}return console.error("No test provided to runTest"),alert("Error: No test provided"),e.a(2);case 2:if(t.code){e.n=3;break}return console.error("Test object missing code property:",t),alert("Error: Test code is missing"),e.a(2);case 3:if(console.log("Test code to execute:",t.code),console.log("Execution mode:",n),"headed"!==n){e.n=5;break}return e.n=4,this.runTestHeaded(t);case 4:e.n=6;break;case 5:return e.n=6,this.runTestHeadless(t);case 6:e.n=8;break;case 7:e.p=7,i=e.v,console.error("Error in runTest method:",i),alert("❌ Failed to run test: "+(i instanceof Error?i.message:"Unknown error"));case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return d.apply(this,arguments)})},{key:"runTestHeaded",value:(a=c(o().m(function e(t){var n,i,r,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("🎭 Running test in HEADED mode - Browser window will be visible"),this.showTestExecutionIndicator("headed"),e.p=1,n=this.parseTestSteps(t.code),i=0;case 2:if(!(i<n.length)){e.n=5;break}return r=n[i],console.log("🎬 Executing step ".concat(i+1,"/").concat(n.length,":"),r),this.showCurrentStep(i+1,n.length,r),e.n=3,this.executeStepVisually(r);case 3:return e.n=4,this.delay(1e3);case 4:i++,e.n=2;break;case 5:this.showTestResult("✅ Test completed successfully in headed mode!"),e.n=7;break;case 6:e.p=6,s=e.v,console.error("Error in headed test execution:",s),this.showTestResult("❌ Test failed in headed mode: "+(s instanceof Error?s.message:"Unknown error"));case 7:return e.p=7,this.hideTestExecutionIndicator(),e.f(7);case 8:return e.a(2)}},e,this,[[1,6,7,8]])})),function(e){return a.apply(this,arguments)})},{key:"runTestHeadless",value:(r=c(o().m(function e(t){var n,i;return o().w(function(e){for(;;)switch(e.n){case 0:console.log("🔇 Running test in HEADLESS mode - Background execution"),this.showTestExecutionIndicator("headless");try{n=document.createElement("script"),i=t.code.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r"),n.textContent="\n        (function() {\n          try {\n            console.log('=== AI TestGen: Headless Test Execution Started ===');\n            console.log('Generated test code:');\n            console.log('".concat(i,"');\n            \n            // Execute the test code in background\n            ").concat(t.code,"\n            \n            console.log('=== Headless Test Execution Completed ===');\n            \n          } catch (execError) {\n            console.error('Error during headless test execution:', execError);\n            throw execError;\n          }\n        })();\n      "),document.head.appendChild(n),document.head.removeChild(n),console.log("✅ Headless test execution completed"),this.showTestResult("✅ Test completed successfully in headless mode! Check console for details.")}catch(e){console.error("Error in headless test execution:",e),this.showTestResult("❌ Test failed in headless mode: "+(e instanceof Error?e.message:"Unknown error"))}finally{this.hideTestExecutionIndicator()}case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"parseTestSteps",value:function(e){var n,o=[],i=t(e.split("\n").filter(function(e){return e.trim()&&!e.trim().startsWith("//")}));try{for(i.s();!(n=i.n()).done;){var r=n.value.trim();(r.includes("click")||r.includes("type")||r.includes("fill")||r.includes("expect")||r.includes("assert")||r.includes("wait"))&&o.push(r)}}catch(e){i.e(e)}finally{i.f()}return o.length>0?o:[e]}},{key:"executeStepVisually",value:(i=c(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return console.log("Executing step:",t),(t.includes("click")||t.includes("type")||t.includes("fill"))&&this.highlightTargetElement(t),e.n=1,this.delay(500);case 1:return e.a(2)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"highlightTargetElement",value:function(e){for(var n=0,o=[/['"`]([^'"`]*?)['"`]/g,/getElementById\(['"`]([^'"`]*?)['"`]\)/g,/querySelector\(['"`]([^'"`]*?)['"`]\)/g];n<o.length;n++){var i,r=o[n],s=t(e.matchAll(r));try{for(s.s();!(i=s.n()).done;){var a=i.value;try{var c=a[1],l=document.querySelector(c)||document.getElementById(c);if(l){this.flashElement(l);break}}catch(e){}}}catch(e){s.e(e)}finally{s.f()}}}},{key:"flashElement",value:function(e){var t=e.style.cssText;e.style.cssText+="\n      outline: 3px solid #ff6b6b !important;\n      outline-offset: 2px !important;\n      background-color: rgba(255, 107, 107, 0.1) !important;\n      transition: all 0.3s ease !important;\n    ",setTimeout(function(){e.style.cssText=t},1e3)}},{key:"showTestExecutionIndicator",value:function(e){var t=document.createElement("div");t.id="ai-testgen-execution-indicator",t.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ".concat("headed"===e?"#4ade80":"#3b82f6",";\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      z-index: 1000000;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    ");var n="headed"===e?"🎭":"🔇",o="headed"===e?"Running Test (Headed Mode)":"Running Test (Headless Mode)";t.innerHTML="".concat(n," ").concat(o),document.body.appendChild(t)}},{key:"showCurrentStep",value:function(e,t,n){var o=document.getElementById("ai-testgen-step-indicator");o||((o=document.createElement("div")).id="ai-testgen-step-indicator",o.style.cssText="\n        position: fixed;\n        top: 80px;\n        right: 20px;\n        background: #1e293b;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 8px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 12px;\n        max-width: 300px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        z-index: 1000000;\n      ",document.body.appendChild(o)),o.innerHTML='\n      <div style="font-weight: 600; margin-bottom: 4px;">Step '.concat(e,"/").concat(t,'</div>\n      <div style="opacity: 0.8; word-break: break-word;">').concat(n,"</div>\n    ")}},{key:"showTestResult",value:function(e){var t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      color: #1e293b;\n      padding: 20px 24px;\n      border-radius: 12px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 16px;\n      font-weight: 500;\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      z-index: 1000001;\n      max-width: 400px;\n      text-align: center;\n      border: 2px solid ".concat(e.includes("✅")?"#10b981":"#ef4444",";\n    "),t.textContent=e,document.body.appendChild(t),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},4e3)}},{key:"hideTestExecutionIndicator",value:function(){var e=document.getElementById("ai-testgen-execution-indicator");e&&e.remove();var t=document.getElementById("ai-testgen-step-indicator");t&&t.remove()}},{key:"delay",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}}],n&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,i,r,a,d,p}();window.aiTestGenContentScript||(window.aiTestGenContentScript=new p)})();