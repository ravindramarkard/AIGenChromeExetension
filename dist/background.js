/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";function e(e,t){var r="";switch(t){case"playwright-js":r+="class PageObject {\n",r+="  constructor(page) {\n",r+="    this.page = page;\n",e.forEach(function(e,t){var o=n(e);r+="    this.".concat(o," = '").concat(e.cssSelector||e.xpath,"';\n")}),r+="  }\n\n",e.forEach(function(e){var t=n(e),o="click".concat(t.charAt(0).toUpperCase()+t.slice(1));r+="  async ".concat(o,"() {\n"),r+="    await this.page.click(this.".concat(t,");\n"),r+="  }\n\n"}),r+="}\n";break;case"cypress-js":r+="class PageObject {\n",e.forEach(function(e){var t=n(e);r+="  get ".concat(t,"() {\n"),r+="    return cy.get('".concat(e.cssSelector||e.xpath,"');\n"),r+="  }\n\n"}),r+="}\n\n",r+="const pageObject = new PageObject();\n";break;case"selenium-java":r+="public class PageObject {\n",r+="    private WebDriver driver;\n\n",r+="    public PageObject(WebDriver driver) {\n",r+="        this.driver = driver;\n",r+="    }\n\n",e.forEach(function(e){var t=n(e),o=e.cssSelector||e.xpath,a=e.cssSelector?"cssSelector":"xpath";r+="    public WebElement get".concat(t.charAt(0).toUpperCase()+t.slice(1),"() {\n"),r+="        return driver.findElement(By.".concat(a,'("').concat(o,'"));\n'),r+="    }\n\n"}),r+="}\n";break;case"selenium-python":r+="class PageObject:\n",r+="    def __init__(self, driver):\n",r+="        self.driver = driver\n\n",e.forEach(function(e){var t=n(e),o=e.cssSelector||e.xpath,a=e.cssSelector?"CSS_SELECTOR":"XPATH";r+="    def get_".concat(t,"(self):\n"),r+="        return self.driver.find_element(By.".concat(a,', "').concat(o,'")\n\n')})}return r}function n(e){return(e.id?e.id.replace(/[^a-zA-Z0-9]/g,""):e.className?e.className.split(" ")[0].replace(/[^a-zA-Z0-9]/g,""):e.textContent?e.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/g,"").substring(0,20):e.tagName.toLowerCase())||"element"}var t=[{framework:{id:"playwright-js",name:"Playwright (JavaScript)",language:"JavaScript",description:"Modern end-to-end testing framework",icon:"🎭"},generateTest:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.includeComments,a=void 0===o||o,c=r.usePageObjectModel,s=void 0!==c&&c,i=r.testName,l=void 0===i?"Generated Test":i,u=r.baseUrl,p=void 0===u?"https://example.com":u,d="";return a&&(d+="// Generated test using AI TestGen\n",d+="// Framework: Playwright (JavaScript)\n",d+="// Generated on: ".concat((new Date).toISOString(),"\n\n")),d+="import { test, expect } from '@playwright/test';\n\n",s&&(d+=e(t,"playwright-js"),d+="\n"),d+="test('".concat(l,"', async ({ page }) => {\n"),d+="  await page.goto('".concat(p,"');\n\n"),n.forEach(function(e,t){var r=e.element;if(r){a&&(d+="  // ".concat(e.type," on ").concat(r.tagName,"\n"));var o=r.cssSelector||r.xpath;switch(e.type){case"click":d+="  await page.click('".concat(o,"');\n");break;case"type":d+="  await page.fill('".concat(o,"', '").concat(e.value||"test input","');\n");break;case"hover":d+="  await page.hover('".concat(o,"');\n");break;case"select":d+="  await page.selectOption('".concat(o,"', '").concat(e.value||"option1","');\n");break;case"assert":d+="  await expect(page.locator('".concat(o,"')).toBeVisible();\n");break;default:d+="  // TODO: Implement ".concat(e.type," action\n")}t<n.length-1&&(d+="\n")}}),d+="});\n"}},{framework:{id:"playwright-python",name:"Playwright (Python)",language:"Python",description:"Modern end-to-end testing framework for Python",icon:"🎭"},generateTest:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.includeComments,a=void 0===o||o,c=r.usePageObjectModel,s=void 0!==c&&c,i=r.testName,l=void 0===i?"test_generated":i,u=r.baseUrl,p=void 0===u?"https://example.com":u,d="";return a&&(d+="# Generated test using AI TestGen\n",d+="# Framework: Playwright (Python)\n",d+="# Generated on: ".concat((new Date).toISOString(),"\n\n")),d+="import pytest\nfrom playwright.sync_api import Page, expect\n\n",s&&(d+=e(t,"playwright-python"),d+="\n"),d+="def ".concat(l,"(page: Page):\n"),d+='    page.goto("'.concat(p,'")\n\n'),n.forEach(function(e,t){var r=e.element;if(r){a&&(d+="    # ".concat(e.type," on ").concat(r.tagName,"\n"));var o=r.cssSelector||r.xpath;switch(e.type){case"click":d+='    page.click("'.concat(o,'")\n');break;case"type":d+='    page.fill("'.concat(o,'", "').concat(e.value||"test input",'")\n');break;case"hover":d+='    page.hover("'.concat(o,'")\n');break;case"select":d+='    page.select_option("'.concat(o,'", "').concat(e.value||"option1",'")\n');break;case"assert":d+='    expect(page.locator("'.concat(o,'")).to_be_visible()\n');break;default:d+="    # TODO: Implement ".concat(e.type," action\n")}t<n.length-1&&(d+="\n")}}),d}},{framework:{id:"cypress-js",name:"Cypress (JavaScript)",language:"JavaScript",description:"Fast, easy and reliable testing for anything that runs in a browser",icon:"🌲"},generateTest:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.includeComments,a=void 0===o||o,c=r.usePageObjectModel,s=void 0!==c&&c,i=r.testName,l=void 0===i?"Generated Test":i,u=r.baseUrl,p=void 0===u?"https://example.com":u,d="";return a&&(d+="// Generated test using AI TestGen\n",d+="// Framework: Cypress (JavaScript)\n",d+="// Generated on: ".concat((new Date).toISOString(),"\n\n")),s&&(d+=e(t,"cypress-js"),d+="\n"),d+="describe('".concat(l,"', () => {\n"),d+="  it('should perform automated test actions', () => {\n",d+="    cy.visit('".concat(p,"');\n\n"),n.forEach(function(e,t){var r=e.element;if(r){a&&(d+="    // ".concat(e.type," on ").concat(r.tagName,"\n"));var o=r.cssSelector||r.xpath;switch(e.type){case"click":d+="    cy.get('".concat(o,"').click();\n");break;case"type":d+="    cy.get('".concat(o,"').type('").concat(e.value||"test input","');\n");break;case"hover":d+="    cy.get('".concat(o,"').trigger('mouseover');\n");break;case"select":d+="    cy.get('".concat(o,"').select('").concat(e.value||"option1","');\n");break;case"assert":d+="    cy.get('".concat(o,"').should('be.visible');\n");break;default:d+="    // TODO: Implement ".concat(e.type," action\n")}t<n.length-1&&(d+="\n")}}),d+="  });\n",d+="});\n"}},{framework:{id:"selenium-java",name:"Selenium (Java)",language:"Java",description:"Browser automation framework for Java",icon:"☕"},generateTest:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.includeComments,a=void 0===o||o,c=r.usePageObjectModel,s=void 0!==c&&c,i=r.testName,l=void 0===i?"GeneratedTest":i,u=r.baseUrl,p=void 0===u?"https://example.com":u,d="";return a&&(d+="// Generated test using AI TestGen\n",d+="// Framework: Selenium (Java)\n",d+="// Generated on: ".concat((new Date).toISOString(),"\n\n")),d+="import org.junit.jupiter.api.Test;\n",d+="import org.junit.jupiter.api.BeforeEach;\n",d+="import org.junit.jupiter.api.AfterEach;\n",d+="import org.openqa.selenium.WebDriver;\n",d+="import org.openqa.selenium.WebElement;\n",d+="import org.openqa.selenium.By;\n",d+="import org.openqa.selenium.chrome.ChromeDriver;\n",d+="import org.openqa.selenium.support.ui.Select;\n",d+="import org.openqa.selenium.interactions.Actions;\n\n",s&&(d+=e(t,"selenium-java"),d+="\n"),d+="public class ".concat(l," {\n"),d+="    private WebDriver driver;\n",d+="    private Actions actions;\n\n",d+="    @BeforeEach\n",d+="    public void setUp() {\n",d+="        driver = new ChromeDriver();\n",d+="        actions = new Actions(driver);\n",d+='        driver.get("'.concat(p,'");\n'),d+="    }\n\n",d+="    @Test\n",d+="    public void testAutomatedActions() {\n",n.forEach(function(e,t){var r=e.element;if(r){a&&(d+="        // ".concat(e.type," on ").concat(r.tagName,"\n"));var o=r.cssSelector||r.xpath,c=r.cssSelector?"cssSelector":"xpath";switch(e.type){case"click":d+="        WebElement element".concat(t," = driver.findElement(By.").concat(c,'("').concat(o,'"));\n'),d+="        element".concat(t,".click();\n");break;case"type":d+="        WebElement element".concat(t," = driver.findElement(By.").concat(c,'("').concat(o,'"));\n'),d+="        element".concat(t,'.sendKeys("').concat(e.value||"test input",'");\n');break;case"hover":d+="        WebElement element".concat(t," = driver.findElement(By.").concat(c,'("').concat(o,'"));\n'),d+="        actions.moveToElement(element".concat(t,").perform();\n");break;case"select":d+="        WebElement element".concat(t," = driver.findElement(By.").concat(c,'("').concat(o,'"));\n'),d+="        Select select".concat(t," = new Select(element").concat(t,");\n"),d+="        select".concat(t,'.selectByVisibleText("').concat(e.value||"option1",'");\n');break;case"assert":d+="        WebElement element".concat(t," = driver.findElement(By.").concat(c,'("').concat(o,'"));\n'),d+="        assert element".concat(t,".isDisplayed();\n");break;default:d+="        // TODO: Implement ".concat(e.type," action\n")}t<n.length-1&&(d+="\n")}}),d+="    }\n\n",d+="    @AfterEach\n",d+="    public void tearDown() {\n",d+="        if (driver != null) {\n",d+="            driver.quit();\n",d+="        }\n",d+="    }\n",d+="}\n"}},{framework:{id:"selenium-python",name:"Selenium (Python)",language:"Python",description:"Browser automation framework for Python",icon:"🐍"},generateTest:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.includeComments,a=void 0===o||o,c=r.usePageObjectModel,s=void 0!==c&&c,i=r.testName,l=void 0===i?"test_generated":i,u=r.baseUrl,p=void 0===u?"https://example.com":u,d="";return a&&(d+="# Generated test using AI TestGen\n",d+="# Framework: Selenium (Python)\n",d+="# Generated on: ".concat((new Date).toISOString(),"\n\n")),d+="import pytest\n",d+="from selenium import webdriver\n",d+="from selenium.webdriver.common.by import By\n",d+="from selenium.webdriver.support.ui import Select\n",d+="from selenium.webdriver.common.action_chains import ActionChains\n",d+="from selenium.webdriver.support.ui import WebDriverWait\n",d+="from selenium.webdriver.support import expected_conditions as EC\n\n",s&&(d+=e(t,"selenium-python"),d+="\n"),d+="class TestAutomation:\n",d+="    def setup_method(self):\n",d+="        self.driver = webdriver.Chrome()\n",d+='        self.driver.get("'.concat(p,'")\n'),d+="        self.wait = WebDriverWait(self.driver, 10)\n\n",d+="    def teardown_method(self):\n",d+="        self.driver.quit()\n\n",d+="    def ".concat(l,"(self):\n"),n.forEach(function(e,t){var r=e.element;if(r){a&&(d+="        # ".concat(e.type," on ").concat(r.tagName,"\n"));var o=r.cssSelector||r.xpath,c=r.cssSelector?"CSS_SELECTOR":"XPATH";switch(e.type){case"click":d+="        element = self.wait.until(EC.element_to_be_clickable((By.".concat(c,', "').concat(o,'")))\n'),d+="        element.click()\n";break;case"type":d+="        element = self.wait.until(EC.presence_of_element_located((By.".concat(c,', "').concat(o,'")))\n'),d+='        element.send_keys("'.concat(e.value||"test input",'")\n');break;case"hover":d+="        element = self.driver.find_element(By.".concat(c,', "').concat(o,'")\n'),d+="        ActionChains(self.driver).move_to_element(element).perform()\n";break;case"select":d+="        element = self.driver.find_element(By.".concat(c,', "').concat(o,'")\n'),d+="        select = Select(element)\n",d+='        select.select_by_visible_text("'.concat(e.value||"option1",'")\n');break;case"assert":d+="        element = self.wait.until(EC.visibility_of_element_located((By.".concat(c,', "').concat(o,'")))\n'),d+="        assert element.is_displayed()\n";break;default:d+="        # TODO: Implement ".concat(e.type," action\n")}t<n.length-1&&(d+="\n")}}),d}}];function r(e){return t.find(function(n){return n.framework.id===e})}function o(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=c(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(i)throw a}}}}function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){if(e){if("string"==typeof e)return s(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,n):void 0}}function s(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function i(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,r,o,a){var i=r&&r.prototype instanceof s?r:s,u=Object.create(i.prototype);return l(u,"_invoke",function(t,r,o){var a,s,i,l=0,u=o||[],p=!1,d={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return a=n,s=0,i=e,d.n=t,c}};function m(t,r){for(s=t,i=r,n=0;!p&&l&&!o&&n<u.length;n++){var o,a=u[n],m=d.p,f=a[2];t>3?(o=f===r)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(s=0,d.v=r,d.n=a[1]):m<f&&(o=t<3||a[0]>r||r>f)&&(a[4]=t,a[5]=r,d.n=f,s=0))}if(o||t>1)return c;throw p=!0,r}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(p&&1===u&&m(u,f),s=u,i=f;(n=s<2?e:i)||!p;){a||(s?s<3?(s>1&&(d.n=-1),m(s,i)):d.n=i:d.v=i);try{if(l=2,a){if(s||(o="next"),n=a[o]){if(!(n=n.call(a,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,s<2&&(s=0)}else 1===s&&(n=a.return)&&n.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((n=(p=d.n<0)?i:t.call(r,d))!==c)break}catch(n){a=e,s=1,i=n}finally{l=1}}return{value:n,done:p}}}(t,o,a),!0),u}var c={};function s(){}function u(){}function p(){}n=Object.getPrototypeOf;var d=[][r]?n(n([][r]())):(l(n={},r,function(){return this}),n),m=p.prototype=s.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=p,l(m,"constructor",p),l(p,"constructor",u),u.displayName="GeneratorFunction",l(p,o,"GeneratorFunction"),l(m),l(m,o,"Generator"),l(m,r,function(){return this}),l(m,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:f}})()}function l(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,n,t,r){function a(n,t){l(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},l(e,n,t,r)}function u(e,n,t,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,o)}function p(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function c(e){u(a,r,o,c,s,"next",e)}function s(e){u(a,r,o,c,s,"throw",e)}c(void 0)})}}var d=[];function m(e,n,t,r){return f.apply(this,arguments)}function f(){return(f=p(i().m(function e(n,t,r,o){var a,c,s,l,u,p,m,f,h,g,v,b;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=Date.now().toString()+Math.random().toString(36).substr(2,9),c=Date.now(),s={url:n,method:t.method||"GET",headers:t.headers||{},body:t.body||"",timestamp:c},e.p=1,l=Date.now(),e.n=2,fetch(n,t);case 2:return u=e.v,p=Date.now(),e.n=3,u.text();case 3:return m=e.v,f={status:u.status,statusText:u.statusText,headers:Object.fromEntries(u.headers.entries()),body:m,timestamp:p,duration:p-l},h={id:a,provider:r,model:o,request:s,response:f},d.push(h),e.a(2,new Response(m,{status:u.status,statusText:u.statusText,headers:u.headers}));case 4:throw e.p=4,b=e.v,g={status:0,statusText:"Network Error",headers:{},body:"",timestamp:Date.now(),duration:Date.now()-c},v={id:a,provider:r,model:o,request:s,response:g,error:b instanceof Error?b.message:"Unknown error"},d.push(v),b;case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function h(e,n){try{chrome.runtime.sendMessage({action:"testGenerationError",error:e})}catch(e){console.log("Could not send error to popup (popup might be closed):",e)}n({error:e})}function g(e,n){return v.apply(this,arguments)}function v(){return(v=p(i().m(function e(n,t){var o,c,s,l,u,p,m,f,g,v,y,w;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("🎯 Background: Handling test generation request:",n),d=[],e.n=1,J();case 1:if(o=e.v,console.log("⚙️ Background: Current settings:",o),o){e.n=2;break}return h("Extension settings not found. Please configure the extension first.",t),e.a(2);case 2:if(o.selectedAIProvider){e.n=3;break}return h("No AI provider selected. Please select a provider in settings.",t),e.a(2);case 3:if(c="","local"!==o.selectedAIProvider){e.n=5;break}if(null!==(s=o.localSetup)&&void 0!==s&&s.endpoint){e.n=4;break}return h("Local endpoint not configured. Please set up local provider in settings.",t),e.a(2);case 4:e.n=8;break;case 5:if("openrouter"!==o.selectedAIProvider){e.n=7;break}if(c=(null===(l=o.openRouterConfig)||void 0===l?void 0:l.apiKey)||""){e.n=6;break}return h("OpenRouter API key not configured. Please add your API key in settings.",t),e.a(2);case 6:e.n=8;break;case 7:if(c=(null===(u=o.apiKeys)||void 0===u?void 0:u[o.selectedAIProvider])||""){e.n=8;break}return p=o.selectedAIProvider.charAt(0).toUpperCase()+o.selectedAIProvider.slice(1),h("".concat(p," API key not configured. Please add your API key in settings."),t),e.a(2);case 8:if(m=r(o.selectedFramework)){e.n=9;break}return h("Unsupported test framework",t),e.a(2);case 9:if(f="",!n.userPrompt||!n.userPrompt.trim()){e.n=11;break}return console.log("🤖 Using AI generation for custom prompt:",n.userPrompt),console.log("🔧 AI Provider:",o.selectedAIProvider,"Framework:",m.framework.name),e.n=10,b(o.selectedAIProvider,c,n,m.framework,o);case 10:f=e.v,console.log("✅ Generated code length:",f.length),e.n=14;break;case 11:if(!(n.elements&&n.elements.length>0)){e.n=12;break}g={includeComments:o.includeComments,usePageObjectModel:o.usePageObjectModel,testName:n.testName||"Generated Test",baseUrl:n.baseUrl||"https://example.com"},f=m.generateTest(n.actions||[],n.elements,g),e.n=14;break;case 12:return e.n=13,b(o.selectedAIProvider,c,n,m.framework,o);case 13:f=e.v;case 14:v={framework:m.framework,code:f,actions:n.actions||[],timestamp:Date.now(),apiCalls:a(d)};try{chrome.runtime.sendMessage({action:"testGenerated",test:v})}catch(e){console.log("Could not send to popup (popup might be closed):",e)}t({success:!0,test:v}),e.n=16;break;case 15:e.p=15,w=e.v,console.error("Error generating test:",w),y=w instanceof Error?w.message:"Unknown error occurred";try{chrome.runtime.sendMessage({action:"testGenerationError",error:y})}catch(e){console.log("Could not send error to popup (popup might be closed):",e)}t({error:y});case 16:return e.a(2)}},e,null,[[0,15]])}))).apply(this,arguments)}function b(e,n,t,r,o){return y.apply(this,arguments)}function y(){return(y=p(i().m(function e(n,t,r,o,a){var c,s,l;return i().w(function(e){for(;;)switch(e.n){case 0:c=w(r,o,a),s=null==a?void 0:a.selectedModel[n],l=n,e.n="openai"===l?1:"anthropic"===l?3:"deepseek"===l?5:"groq"===l?7:"local"===l?9:"openrouter"===l?11:13;break;case 1:return e.n=2,k(t,c,s);case 2:case 4:case 6:case 8:case 10:case 12:return e.a(2,e.v);case 3:return e.n=4,S(t,c,s);case 5:return e.n=6,T(t,c,s);case 7:return e.n=8,A(t,c,s);case 9:return e.n=10,C(null==a?void 0:a.localSetup,c);case 11:return e.n=12,I(null==a?void 0:a.openRouterConfig,c,s);case 13:throw new Error("Unsupported AI provider: ".concat(n));case 14:return e.a(2)}},e)}))).apply(this,arguments)}function w(e,n,t){var r=e.actions,o=(e.elements,e.userPrompt),a=e.pageContext,c=n||e.framework,s=!1!==(null==t?void 0:t.includeComments),i=!0===(null==t?void 0:t.usePageObjectModel),l="Generate ".concat(c.name," test code in ").concat(c.language," for the following scenario:\n\nUser Request: ").concat(o||"Generate test for the selected elements");return a&&(l+="\n\nPage Context:\n- URL: ".concat(a.url,"\n- Title: ").concat(a.title,"\n- Selected Elements: ").concat(a.elementCount)),l+="\n\nElements and Actions:\n".concat((r||[]).map(function(e,n){var t=e.element,r="".concat(n+1,". ").concat(e.type.toUpperCase()," on element: ").concat(t.tagName).concat(t.id?"#".concat(t.id):"").concat(t.className?".".concat(t.className):"","\n     Selector: ").concat(t.cssSelector,"\n     XPath: ").concat(t.xpath,"\n     Text Content: ").concat(t.textContent?t.textContent.substring(0,100):"N/A");if(t.context&&(r+="\n     Position: ".concat(t.context.position.x,", ").concat(t.context.position.y," (").concat(t.context.position.width,"x").concat(t.context.position.height,")\n     Visible: ").concat(t.context.visible)),t.accessibility){var o=t.accessibility;(o.role||o.ariaLabel||o.title)&&(r+="\n     Accessibility: ".concat(o.role?'role="'.concat(o.role,'"'):""," ").concat(o.ariaLabel?'aria-label="'.concat(o.ariaLabel,'"'):""," ").concat(o.title?'title="'.concat(o.title,'"'):"").trim())}return r+"\n     ".concat(e.value?"Value: ".concat(e.value):"","\n     Description: ").concat(e.description)}).join("\n"),"\n\nRequirements:\n- Use modern best practices for ").concat(c.name,"\n- Include proper waits and error handling\n- Use reliable selectors (prefer CSS selectors over XPath when possible)\n- Follow ").concat(c.language," coding conventions\n- Make the test maintainable and readable\n- Handle potential race conditions and flaky elements\n- Use appropriate assertions for validation"),s&&(l+="\n- Add descriptive comments explaining each step"),i&&(l+="\n- Structure the code using Page Object Model pattern"),l+"\n\nGenerate only the test code without explanations or markdown formatting."}function k(e,n,t){return E.apply(this,arguments)}function E(){return(E=p(i().m(function e(n,t,r){var o,a,c;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({model:r||"gpt-4",messages:[{role:"system",content:"You are an expert test automation engineer specializing in creating robust, maintainable test code. Focus on best practices, proper error handling, and reliable selectors."},{role:"user",content:t}],temperature:.1,max_tokens:3e3})},"openai",r||"gpt-4");case 1:return o=e.v,e.n=2,o.json();case 2:if(a=e.v,o.ok){e.n=3;break}throw new Error((null===(c=a.error)||void 0===c?void 0:c.message)||"OpenAI API error");case 3:return e.a(2,a.choices[0].message.content)}},e)}))).apply(this,arguments)}function S(e,n,t){return P.apply(this,arguments)}function P(){return(P=p(i().m(function e(n,t,r){var o,a,c;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":n,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:r||"claude-3-sonnet-20240229",max_tokens:3e3,messages:[{role:"user",content:t}]})},"Anthropic",r||"claude-3-sonnet-20240229");case 1:return o=e.v,e.n=2,o.json();case 2:if(a=e.v,o.ok){e.n=3;break}throw new Error((null===(c=a.error)||void 0===c?void 0:c.message)||"Anthropic API error");case 3:return e.a(2,a.content[0].text)}},e)}))).apply(this,arguments)}function T(e,n,t){return x.apply(this,arguments)}function x(){return(x=p(i().m(function e(n,t,r){var o,a,c;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({model:r||"deepseek-chat",messages:[{role:"system",content:"You are an expert test automation engineer specializing in creating robust, maintainable test code. Focus on best practices, proper error handling, and reliable selectors."},{role:"user",content:t}],temperature:.1,max_tokens:3e3})},"DeepSeek",r||"deepseek-chat");case 1:return o=e.v,e.n=2,o.json();case 2:if(a=e.v,o.ok){e.n=3;break}throw new Error((null===(c=a.error)||void 0===c?void 0:c.message)||"DeepSeek API error");case 3:return e.a(2,a.choices[0].message.content)}},e)}))).apply(this,arguments)}function A(e,n,t){return O.apply(this,arguments)}function O(){return(O=p(i().m(function e(n,t,r){var o,a,c;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({model:r||"llama-3.1-70b-versatile",messages:[{role:"system",content:"You are an expert test automation engineer specializing in creating robust, maintainable test code. Focus on best practices, proper error handling, and reliable selectors."},{role:"user",content:t}],temperature:.1,max_tokens:3e3})},"Groq",r||"llama-3.1-70b-versatile");case 1:return o=e.v,e.n=2,o.json();case 2:if(a=e.v,o.ok){e.n=3;break}throw new Error((null===(c=a.error)||void 0===c?void 0:c.message)||"Groq API error");case 3:return e.a(2,a.choices[0].message.content)}},e)}))).apply(this,arguments)}function C(e,n){return j.apply(this,arguments)}function j(){return(j=p(i().m(function e(n,t){var r,o,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n&&t){e.n=1;break}throw new Error("Local setup configuration or prompt missing. Please configure endpoint and model in settings.");case 1:if(n.endpoint){e.n=2;break}throw new Error("Local AI endpoint not configured. Please set endpoint (e.g., http://localhost:11434) in settings.");case 2:if(n.model){e.n=3;break}throw new Error("Local AI model not specified. Please set model name (e.g., llama3.1:8b, codellama) in settings.");case 3:return e.p=3,e.n=4,m("".concat(n.endpoint,"/api/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:n.model,prompt:"You are an expert test automation engineer specializing in creating robust, maintainable test code. Focus on best practices, proper error handling, and reliable selectors.\n\n".concat(t),temperature:n.temperature||.1,max_tokens:n.maxTokens||3e3,stream:!1})},"Local Provider",n.model);case 4:if((r=e.v).ok){e.n=8;break}if(403!==r.status){e.n=5;break}throw new Error("Local AI service forbidden. Check if Ollama is running and accessible at ".concat(n.endpoint));case 5:if(404!==r.status){e.n=6;break}throw new Error("Model '".concat(n.model,"' not found. Run: ollama pull ").concat(n.model));case 6:if(!(r.status>=500)){e.n=7;break}throw new Error("Local AI service error (".concat(r.status,"). Check if Ollama is running properly."));case 7:throw new Error("Local provider error: ".concat(r.statusText," (").concat(r.status,")"));case 8:return e.n=9,r.json();case 9:return o=e.v,e.a(2,o.response||o.text||o.content);case 10:if(e.p=10,"TypeError"!==(a=e.v).name||!a.message.includes("fetch")){e.n=11;break}throw new Error("Cannot connect to local AI service at ".concat(n.endpoint,". Please ensure Ollama is running: 'ollama serve'"));case 11:throw a;case 12:return e.a(2)}},e,null,[[3,10]])}))).apply(this,arguments)}function I(e,n,t){return _.apply(this,arguments)}function _(){return(_=p(i().m(function e(n,t,r){var o,a,c,s;return i().w(function(e){for(;;)switch(e.n){case 0:if(n&&t&&n.apiKey){e.n=1;break}throw new Error("OpenRouter configuration or prompt missing");case 1:if(r){e.n=2;break}throw new Error("OpenRouter model not specified");case 2:return e.n=3,m("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(n.apiKey),"Content-Type":"application/json","HTTP-Referer":"https://ai-testgen-extension.com","X-Title":"AI TestGen Extension"},body:JSON.stringify({model:r,messages:[{role:"system",content:"You are an expert test automation engineer specializing in creating robust, maintainable test code. Focus on best practices, proper error handling, and reliable selectors."},{role:"user",content:t}],temperature:n.temperature||.1,max_tokens:n.maxTokens||3e3})},"OpenRouter",r);case 3:if((o=e.v).ok){e.n=5;break}return e.n=4,o.json();case 4:throw c=e.v,new Error((null===(a=c.error)||void 0===a?void 0:a.message)||"OpenRouter API error");case 5:return e.n=6,o.json();case 6:return s=e.v,e.a(2,s.choices[0].message.content)}},e)}))).apply(this,arguments)}function G(e,n){return U.apply(this,arguments)}function U(){return(U=p(i().m(function e(n,t){var r,a,c,s,l,u,p,d,m;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.local.get(["savedTests"]);case 1:return r=e.v,(a=r.savedTests||[]).push(n),e.n=2,chrome.storage.local.set({savedTests:a});case 2:return e.p=2,e.n=3,chrome.tabs.query({});case 3:c=e.v,s=o(c),e.p=4,s.s();case 5:if((l=s.n()).done){e.n=10;break}if(!(u=l.value).id){e.n=9;break}return e.p=6,e.n=7,chrome.tabs.sendMessage(u.id,{action:"notifyDevTools",type:"NEW_TEST_GENERATED",data:n});case 7:e.n=9;break;case 8:e.p=8,e.v;case 9:e.n=5;break;case 10:e.n=12;break;case 11:e.p=11,p=e.v,s.e(p);case 12:return e.p=12,s.f(),e.f(12);case 13:e.n=15;break;case 14:e.p=14,d=e.v,console.error("Error notifying DevTools panel:",d);case 15:t({success:!0}),e.n=17;break;case 16:e.p=16,m=e.v,console.error("Error saving test:",m instanceof Error?m.message:"Unknown error"),t({error:m instanceof Error?m.message:"Unknown error"});case 17:return e.a(2)}},e,null,[[6,8],[4,11,12,13],[2,14],[0,16]])}))).apply(this,arguments)}function D(e){return N.apply(this,arguments)}function N(){return(N=p(i().m(function e(n){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,J();case 1:t=e.v,n({success:!0,settings:t}),e.n=3;break;case 2:e.p=2,r=e.v,n({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function M(e,n){return B.apply(this,arguments)}function B(){return(B=p(i().m(function e(n,t){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.sync.set({settings:n});case 1:t({success:!0}),e.n=3;break;case 2:e.p=2,r=e.v,t({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function F(e){return L.apply(this,arguments)}function L(){return(L=p(i().m(function e(n){var t,r,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.local.get(["chatHistory"]);case 1:t=e.v,r=t.chatHistory||[],n({success:!0,chatHistory:r}),e.n=3;break;case 2:e.p=2,o=e.v,n({error:o instanceof Error?o.message:"Unknown error occurred"});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function q(e,n){return R.apply(this,arguments)}function R(){return(R=p(i().m(function e(n,t){var r,o,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.local.get(["chatHistory"]);case 1:return r=e.v,(o=r.chatHistory||[]).push(n),o.length>100&&o.splice(0,o.length-100),e.n=2,chrome.storage.local.set({chatHistory:o});case 2:t({success:!0}),e.n=4;break;case 3:e.p=3,a=e.v,t({error:a instanceof Error?a.message:"Unknown error occurred"});case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function J(){return W.apply(this,arguments)}function W(){return(W=p(i().m(function e(){var n;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.sync.get(["settings"]);case 1:return n=e.v,e.a(2,n.settings||{selectedFramework:"playwright-ts",selectedAIProvider:"openai",apiKeys:{},autoGenerate:!1,includeComments:!0,usePageObjectModel:!1})}},e)}))).apply(this,arguments)}chrome.runtime.onInstalled.addListener(function(){console.log("AI TestGen extension installed"),chrome.storage.sync.set({settings:{selectedFramework:"playwright-js",selectedAIProvider:"openai",apiKeys:{},selectedModel:{},localSetup:{endpoint:"http://localhost:11434",model:"llama-3.1"},openRouterConfig:{apiKey:"",model:"openai/gpt-3.5-turbo"},connectionStatus:{},autoGenerate:!1,includeComments:!0,usePageObjectModel:!1}})}),chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.create({id:"openSidePanel",title:"Open AI TestGen Side Panel",contexts:["action"]})}),chrome.contextMenus.onClicked.addListener(function(){var e=p(i().m(function e(n,t){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if("openSidePanel"!==n.menuItemId||null==t||!t.id){e.n=6;break}if(e.p=1,!chrome.sidePanel||!chrome.sidePanel.open){e.n=3;break}return e.n=2,chrome.sidePanel.open({tabId:t.id});case 2:e.n=4;break;case 3:console.warn("Side panel API not available"),chrome.action.setPopup({popup:"popup.html"});case 4:e.n=6;break;case 5:e.p=5,r=e.v,console.error("Failed to open side panel:",r);case 6:return e.a(2)}},e,null,[[1,5]])}));return function(n,t){return e.apply(this,arguments)}}()),chrome.runtime.onMessage.addListener(function(e,n,t){switch(e.action){case"generateTest":return p(i().m(function n(){var r;return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,g(e.data,t);case 1:n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error in generateTest handler:",r),t({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return n.a(2)}},n,null,[[0,2]])}))(),!0;case"saveTest":return p(i().m(function n(){var r;return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,G(e.data,t);case 1:n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error in saveTest handler:",r),t({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return n.a(2)}},n,null,[[0,2]])}))(),!0;case"getSettings":return p(i().m(function e(){var n;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,D(t);case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("Error in getSettings handler:",n),t({error:n instanceof Error?n.message:"Unknown error occurred"});case 3:return e.a(2)}},e,null,[[0,2]])}))(),!0;case"updateSettings":return p(i().m(function n(){var r;return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,M(e.data,t);case 1:n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error in updateSettings handler:",r),t({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return n.a(2)}},n,null,[[0,2]])}))(),!0;case"getChatHistory":return p(i().m(function e(){var n;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,F(t);case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("Error in getChatHistory handler:",n),t({error:n instanceof Error?n.message:"Unknown error occurred"});case 3:return e.a(2)}},e,null,[[0,2]])}))(),!0;case"saveChatMessage":return p(i().m(function n(){var r;return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,q(e.data,t);case 1:n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error in saveChatMessage handler:",r),t({error:r instanceof Error?r.message:"Unknown error occurred"});case 3:return n.a(2)}},n,null,[[0,2]])}))(),!0;default:t({error:"Unknown action"})}})})();